---
title: "Examples With Peak Finder Script"
author: "Michael Olvera"
date: "September 8, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Using Peak Finder

This is a quick guide on how to use the Peak Finder script. Feel free to follow along with the code in this file to make sure everything is working well. For this file, R code is in boxes, and outputs are boxes with **##** before the code.

Before starting, include the following line of code at the top
of your script:

```{r source}
source("pf/peakFinder.R")
```

## Preprocessing

Samples must be preprocessed to be a dataframe with **Time**
included in column 1, and all other columns samples. A
preprocessed dataset is included in the zip folder:

```{r exampleData}
example <- read.csv('pf/data/CaHandUT1.csv')
head(example) # Prints first 6 rows
```

As a side note, make sure all of your comlumes are numeric/integers. A common mistake with R is that .csv
files are loaded with columns being factors. 

```{r exampleData2}
str(example)
```

As you can see above, all columns are of **type** numeric (**num**). Looking a the second row of the output, *$ Time* indicates the title of the column, then the datatype, followed by the first few data entries. 

## Analysis

The main functions are *runTestGraph()* and *analyzeExperiemnt()*. You can call runTest() on you dataset to see how the function calls each peak.
  
The result will be a graph of the GcAMP flow including:
  
* Peak calls (green).
* Trough calls (red).
* T50 mids (purple and red).


```{r runTest1}
runTestGraph(example[,c(1,3)]) #test only the second sample
```

Looks good. Lets look at our first sample.

```{r runTest2}
runTestGraph(example[,1:2]) #test only the first sample
```

Looks like there is something wrong with the data. We can run the experiment and see if the program can correct it. 

```{r analyze1}
analyzeExperiment(example) 
```

Looks like the first sample had a missing value at index 1025. The program thankfully fixed it automaticall. 

The output can be saved, and extracted to be used in Excel/Prism. 

```{r eval=F}
output <- analyzeExperiment(example) 
write.csv(output, "~/Desktop/results.csv")
```

If you have any questions or bugs, let me know (michael.olvera@gladstone.ucsf.edu).

```{r end}
sessionInfo() 
```
